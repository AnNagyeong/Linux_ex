# Linux_ex 비밀번호 없이 SSH 접속

ssh -p 2222 reallinux@211.58.70.130
비밀번호로 SSH에 접속하고 yes 입력 후 기존에 설정한 비밀번호를 입력한다.
: ssh - 보안 연결을 위한 명령어
: -p 2222 - SSH 포트를 2222로 지정(기본은 22)
: reallinux@211.58.70.130 - 접속할 계정과 서버 IP
첫 접속 시 서버 지문(Fingerprint)을 확인하고 yes 입략

exit
: 현재 세션 종료 후 로컬 터미널로 복귀함
: Ctrl + D - 동일하게 세션 종료 가능
중요한 작업 중에는 종료하면 안 됨.(연결이 끊어지기 때문에)

ssh-keygen -t rsa -N "" -f /home/reallinux/.ssh/id_rsa
: ssh-keygen - SSH 키 생성 명령어
: -t rsa - RSA 알고리즘 방식 지정
생성 결로는 기본적으로 ~/.ssh/에 저장됨
팁) 키 생성 시 암호(passphrase)를 설정하면 보안이 강화됨
만약 기본값으로 생성 시 엔터 반복해서 누르기

cat ~/.ssh/id_rsa.pub
: cat - 파일 내용 출력
: ~/.ssh/id_rsa.pub - 공개키 파일 경로

ssh-copy-id -p 2222 reallinux@211.58.70.130
: ssh-copy-id - 공개키 복사 명령어
: -p 2222 - SSH 포트 지정
서버 계정/주소 입력 후 최초 1회 비밀번호 필요
>> 이 과정을 거치면 다음부터는 비밀번호 없이도 접속 가능

ssh -p 2222 reallinux@211.58.70.130
접속 시 비밀번호 입력 없이 바로 로그인되면 성공!
비밀번호가 요구되면 키 등록 또는 퍼미션 설정을 다시 확인해야 함.
서버 측 ~/.ssh 폴더와 authorized_keys 권한이 700/600인지 확인 필요

exit

: quit

--------------------------------------------------------------
가상 머신(Rocky Linux)에서 SSH 포트를 변경하고 접속하는 실습을 했다.
기본 22번 포트를 2222번으로 변경하기 위해 sshd_config 파일을 수정하고, 방화벽에서 해당 포트를 허용했다.
하지만 설정 후에도 SSH가 실행되지 않아 systemctl status, ss, journalctl 명령어로 원인을 추적했다.

로그를 확인한 결과, SELinux 정책 때문에 2222 포트 바인딩이 거부되고 있다는 것을 알게 되었고,
semanage port 명령어로 SSH가 사용할 수 있는 포트로 2222번을 등록해 문제를 해결했다.
이후 SSH 서비스가 정상 실행되었고, ssh -p 2222 rocky@localhost로 접속에 성공했다.

이번 실습을 통해 SSH 포트 변경 시 설정 파일뿐 아니라 방화벽과 SELinux 정책을 함께 고려해야 한다는 점,
그리고 오류 발생 시 로그를 확인하는 것이 문제 해결의 핵심이라는 것을 배웠다.

결론은 내 가상 머신에서 예제를 적용시키려면 나의 포트를 확인해야 하고
변경할 포트 번호를 추가해야 했다는 것..
일단 키보드에서 i를 눌러 # Port 22 밑에 Port 2222 를 입력해서 저장, :wq로 빠져나오기
이건 처음 해봐서 굉장히 어려웠지만 나름대로 감을 잡으니 그 뒤로는 이해가 잘 돼서 
꼭 필요했던 실습이라는 생각이 들었다
어쨌든 로그를 잘 봐야 한다는..
